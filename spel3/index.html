<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Rybergs Slott Deluxe</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:radial-gradient(circle,#140022,#000);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    color:white;
}

/* PERFEKT CENTER */
.wrapper{
    width:460px;
    padding:45px;
    border-radius:28px;
    text-align:center;
    background:#14001d;
    box-shadow:0 0 90px #ff00ff40;
}

/* TITLE */
h1{
    margin:20px 0 30px;
    color:gold;
    text-shadow:0 0 15px gold;
}

/* GRID */
#grid{
    display:grid;
    grid-template-columns:repeat(4,85px);
    grid-template-rows:repeat(4,85px);
    gap:12px;
    margin:25px auto;
}

/* SYMBOL */
.cell{
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:48px;
    border-radius:16px;
    background:linear-gradient(#2b003b,#160022);
    transition:transform .2s, opacity .2s;
}

/* EXPLOSION */
.win{
    animation:explode .45s ease forwards;
}
@keyframes explode{
    0%{transform:scale(1);}
    50%{transform:scale(1.5); opacity:.3;}
    100%{opacity:0;}
}

/* BIG WIN TEXT */
.winText{
    height:36px;
    font-size:26px;
    font-weight:bold;
}

.mega{
    animation:mega .6s infinite;
}
@keyframes mega{
    50%{transform:scale(1.2); text-shadow:0 0 30px gold;}
}

/* BUTTONS */
button{
    padding:10px 20px;
    margin:6px;
    border:none;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
}

.spin{background:#00ffe7;}
.bonus{background:#ff9900;}
.home{background:#ff5555;}

.bonusMode{
    box-shadow:0 0 120px #ff00ff;
    background:radial-gradient(circle,#3a0057,#110011);
}
</style>
</head>

<body>

<div class="wrapper" id="wrapper">

<h1>üè∞ Rybergs Slott Deluxe</h1>

Satsning:
<input id="betInput" type="number" value="100" min="10" max="1000">

<div id="grid"></div>

<div id="winText" class="winText"></div>
<div id="multText"></div>
<div id="bonusInfo"></div>

<button class="spin" onclick="spin()">üé∞ Snurra</button>
<button class="bonus" onclick="buyBonus()">üíé K√∂p Bonus</button>
<button class="home" onclick="goHome()">‚Üê Tillbaka</button>

<div>Saldo: <span id="money">1000</span> kr</div>

</div>

<script>
const SIZE=4;
const symbols=["üíé","üëë","üçÄ","‚≠ê","üè∞","üî•","üßø"]; // üî• wild, üßø scatter

let grid=[];
let money=1000;
let spinning=false;
let bonusSpins=0;

const gridEl=document.getElementById("grid");
const moneyEl=document.getElementById("money");
const winText=document.getElementById("winText");
const multText=document.getElementById("multText");
const bonusInfo=document.getElementById("bonusInfo");
const wrapper=document.getElementById("wrapper");
const betInput=document.getElementById("betInput");

function rand(){ return symbols[Math.floor(Math.random()*symbols.length)]; }

function createGrid(){
    gridEl.innerHTML="";
    for(let r=0;r<SIZE;r++){
        grid[r]=[];
        for(let c=0;c<SIZE;c++){
            let d=document.createElement("div");
            d.className="cell";
            d.dataset.r=r;
            d.dataset.c=c;
            gridEl.appendChild(d);
            grid[r][c]=rand();
        }
    }
    render();
}

function render(){
    document.querySelectorAll(".cell").forEach(cell=>{
        let r=cell.dataset.r,c=cell.dataset.c;
        cell.textContent=grid[r][c];
        cell.classList.remove("win");
        cell.style.opacity=1;
    });
}

/* reel animation */
function animateSpin(speed,done){
    let cells=document.querySelectorAll(".cell");
    let start=Date.now();

    function frame(){
        let t=(Date.now()-start)/speed;
        cells.forEach(c=>c.style.transform=`translateY(${Math.sin(t*12)*22}px)`);
        if(t<1) requestAnimationFrame(frame);
        else{
            cells.forEach(c=>c.style.transform="translateY(0)");
            done();
        }
    }
    frame();
}

function checkWins(){
    let lines=[];

    for(let r=0;r<SIZE;r++){
        let row=grid[r];
        if(row.every(x=>x===row[0]||x==="üî•"))
            lines.push(row.map((_,i)=>[r,i]));
    }

    for(let c=0;c<SIZE;c++){
        let col=[grid[0][c],grid[1][c],grid[2][c],grid[3][c]];
        if(col.every(x=>x===col[0]||x==="üî•"))
            lines.push([[0,c],[1,c],[2,c],[3,c]]);
    }

    return lines;
}

function cascade(){
    for(let c=0;c<SIZE;c++){
        let col=[];
        for(let r=0;r<SIZE;r++) if(grid[r][c]!="") col.push(grid[r][c]);
        while(col.length<SIZE) col.unshift(rand());
        for(let r=0;r<SIZE;r++) grid[r][c]=col[r];
    }
}

function spin(){
    if(spinning) return;
    spinning=true;

    let bet=parseInt(betInput.value)||100;
    if(money<bet){ spinning=false; return; }

    money-=bet;
    moneyEl.textContent=money;

    let speed=bonusSpins>0?1800:1200;

    animateSpin(speed,()=>{
        for(let r=0;r<SIZE;r++)
            for(let c=0;c<SIZE;c++)
                grid[r][c]=rand();

        processWins(bet);
    });
}

function processWins(bet){
    render();

    let wins=checkWins();
    let scatters=grid.flat().filter(x=>x==="üßø").length;

    if(scatters>=3 && bonusSpins===0){
        bonusSpins=10;
        wrapper.classList.add("bonusMode");
    }

    if(wins.length===0){
        finishSpin();
        return;
    }

    let total=0;
    wins.forEach(line=>{
        let mult=bonusSpins>0?Math.floor(Math.random()*8)+3:Math.floor(Math.random()*4)+2;
        total+=bet*mult;

        line.forEach(([r,c])=>{
            grid[r][c]="";
            document.querySelector(`[data-r='${r}'][data-c='${c}']`).classList.add("win");
        });
    });

    money+=total;
    moneyEl.textContent=money;

    if(total>=bet*8){
        winText.textContent="üéâ MEGA WIN!";
        winText.classList.add("mega");
    }
    else if(total>=bet*4) winText.textContent="‚ú® BIG WIN!";
    else winText.textContent="WIN!";

    setTimeout(()=>{
        winText.classList.remove("mega");
        cascade();
        processWins(bet);
    },500);
}

function finishSpin(){
    spinning=false;

    if(bonusSpins>0){
        bonusSpins--;
        bonusInfo.textContent="BONUS: "+bonusSpins+" kvar";
        if(bonusSpins>0) setTimeout(spin,1000);
        else{
            wrapper.classList.remove("bonusMode");
            bonusInfo.textContent="";
        }
    }
}

function buyBonus(){
    let bet=parseInt(betInput.value)||100;
    if(bet<200) return;
    bonusSpins=10;
    wrapper.classList.add("bonusMode");
    spin();
}

function goHome(){
    window.location.href="../index.html";
}

createGrid();
</script>
</body>
</html>
