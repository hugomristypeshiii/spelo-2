<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üè∞ Rybergs Slott 4x4</title>
<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background: radial-gradient(circle,#1a0033,#000);
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.wrapper{
    text-align:center;
    background:#111;
    padding:20px;
    border-radius:20px;
    box-shadow:0 0 30px #ff00cc;
}
h1{
    color:#ffd700;
    text-shadow:0 0 15px #ffd700;
    margin-bottom:10px;
}
#grid{
    display:grid;
    grid-template-columns: repeat(4, 80px);
    grid-template-rows: repeat(4, 80px);
    gap:5px;
    justify-content:center;
    margin:20px 0;
}
.cell{
    width:80px;
    height:80px;
    background:#222;
    border-radius:8px;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:40px;
    transition: all 0.2s ease;
}
.win{
    animation: flash 0.5s ease infinite;
}
@keyframes flash{
    0%,100%{background:#222;}
    50%{background:gold;}
}
button{
    padding:10px 20px;
    margin:5px;
    border:none;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
}
.spin{background:#00ffe7;}
.home{background:#ff5555;}
.stats{
    margin-top:10px;
    font-size:18px;
}
.winText{
    font-size:28px;
    margin:10px 0;
    color:#ff0;
    text-shadow:0 0 15px #ff0;
}
</style>
</head>
<body>
<div class="wrapper">
    <h1>üè∞ Rybergs Slott 4x4</h1>
    <div id="grid"></div>
    <div class="winText" id="winText"></div>
    <button class="spin" onclick="spin()">üé∞ Snurra (Satsa 100 kr)</button>
    <button class="home" onclick="goHome()">‚Üê Tillbaka</button>
    <div class="stats">
        Pengar: <span id="score">1000</span> kr |
        Highscore: <span id="highscore">0</span> kr
    </div>
</div>

<script>
const gridSize = 4;
const symbols = ["üíé","üëë","üçÄ","‚≠ê","üó°Ô∏è","üè∞"];
let grid = [];
const gridEl = document.getElementById("grid");
const scoreEl = document.getElementById("score");
const highEl = document.getElementById("highscore");
const winTextEl = document.getElementById("winText");
let score = 1000;
let highscore = parseInt(localStorage.getItem("slotHigh")) || score;
highEl.textContent = highscore;

// ===== Init grid =====
function initGrid(){
    gridEl.innerHTML="";
    grid=[];
    for(let r=0;r<gridSize;r++){
        grid[r]=[];
        for(let c=0;c<gridSize;c++){
            let sym = symbols[Math.floor(Math.random()*symbols.length)];
            grid[r][c] = sym;
            const cell = document.createElement("div");
            cell.className="cell";
            cell.dataset.row=r;
            cell.dataset.col=c;
            cell.textContent=sym;
            gridEl.appendChild(cell);
        }
    }
}

// ===== Render =====
function renderGrid(){
    const cells = document.querySelectorAll(".cell");
    cells.forEach(cell=>{
        let r = parseInt(cell.dataset.row);
        let c = parseInt(cell.dataset.col);
        cell.textContent = grid[r][c];
        cell.classList.remove("win");
    });
}

// ===== Check wins =====
function checkWin(){
    let lines = [];
    // horizontal
    for(let r=0;r<gridSize;r++){
        if(new Set(grid[r]).size===1){
            lines.push([[r,0],[r,1],[r,2],[r,3]]);
        }
    }
    // vertical
    for(let c=0;c<gridSize;c++){
        let col = [grid[0][c],grid[1][c],grid[2][c],grid[3][c]];
        if(new Set(col).size===1){
            lines.push([[0,c],[1,c],[2,c],[3,c]]);
        }
    }
    // diagonals
    let diag1 = [grid[0][0],grid[1][1],grid[2][2],grid[3][3]];
    if(new Set(diag1).size===1) lines.push([[0,0],[1,1],[2,2],[3,3]]);
    let diag2 = [grid[0][3],grid[1][2],grid[2][1],grid[3][0]];
    if(new Set(diag2).size===1) lines.push([[0,3],[1,2],[2,1],[3,0]]);
    return lines;
}

// ===== Spin =====
function spin(){
    if(score<100){
        alert("Inte tillr√§ckligt med pengar!");
        return;
    }
    score -=100;
    winTextEl.textContent="";
    // fyll grid med nya symboler
    for(let r=0;r<gridSize;r++){
        for(let c=0;c<gridSize;c++){
            grid[r][c] = symbols[Math.floor(Math.random()*symbols.length)];
        }
    }
    renderGrid();
    const winLines = checkWin();
    let totalWin = 0;

    if(winLines.length>0){
        winLines.forEach(line=>{
            line.forEach(([r,c])=>{
                document.querySelector(`.cell[data-row='${r}'][data-col='${c}']`).classList.add("win");
            });
            // win per line: satsning * random multiplier
            let mult = Math.floor(Math.random()*5)+2; // 2x-6x
            totalWin += 100*mult;
        });

        score += totalWin;
        if(totalWin>=400) winTextEl.textContent="üéâ MEGA WIN!";
        else if(totalWin>=200) winTextEl.textContent="‚ú® BIG WIN!";
        else winTextEl.textContent="üéâ WIN!";
    }

    scoreEl.textContent=score;
    if(score>highscore){
        highscore=score;
        highEl.textContent=highscore;
        localStorage.setItem("slotHigh",highscore);
    }
}

function goHome(){
    window.location.href="../index.html";
}

// ===== Start =====
initGrid();
renderGrid();
</script>
</body>
</html>
