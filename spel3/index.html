<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>üè∞ Rybergs Slott Deluxe</title>

<style>
body{
    margin:0;
    background:radial-gradient(circle,#1b0030,#000);
    font-family:Arial, sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
    color:white;
}

/* ===== SLOT MACHINE ===== */
.wrapper{
    width:560px;
    padding:35px;
    border-radius:30px;
    text-align:center;
    background:#160020;
    box-shadow:0 0 140px #ff00ff40;
    transform-origin:center;
}

h1{
    margin:10px 0 18px;
    font-size:26px;
    color:gold;
    text-shadow:0 0 15px gold;
}

/* ===== GRID ===== */
#grid{
    display:grid;
    grid-template-columns:repeat(4,100px);
    grid-template-rows:repeat(4,100px);
    gap:10px;
    margin:18px auto;
}

.cell{
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:48px;
    border-radius:16px;
    background:linear-gradient(#2b0038,#140018);
    transition:transform .2s, opacity .2s, box-shadow .2s;
}

/* WIN */
.win{
    box-shadow:0 0 30px gold;
    animation:flash .4s infinite;
}
@keyframes flash{
    50%{transform:scale(1.2)}
}

/* SPIN ANIMATION */
.spinning{
    animation:roll .25s linear infinite;
}
@keyframes roll{
    50%{transform:translateY(6px)}
}

/* TEXT */
.winText{
    height:30px;
    font-size:22px;
    font-weight:bold;
    margin-top:5px;
}

.mega{
    animation:mega .5s infinite;
}
@keyframes mega{
    50%{transform:scale(1.25); text-shadow:0 0 30px gold;}
}

/* BUTTONS */
button{
    padding:10px 20px;
    margin:5px;
    border:none;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
}

.spin{background:#00ffe7;}
.bonus{background:#ff9900;}
.home{background:#ff5555;}

.bonusMode{
    box-shadow:0 0 180px #ff00ff;
}
</style>
</head>

<body>

<div class="wrapper" id="wrapper">

<h1>üè∞ Rybergs Slott Deluxe</h1>

Bet:
<input id="betInput" type="number" value="100" min="10" max="1000">

<div id="grid"></div>

<div id="winText" class="winText"></div>
<div id="bonusInfo"></div>

üí∞ Jackpot: <span id="jackpot">5000</span> kr

<br><br>

<button class="spin" onclick="spin()">üé∞ Spin</button>
<button class="bonus" onclick="buyBonus()">üíé Bonus 10 spins (200kr)</button>
<button class="home" onclick="goHome()">‚Üê Home</button>

<div style="margin-top:8px">
Saldo: <span id="money">1000</span> kr
</div>

</div>

<script>
const SIZE=4;
const symbols=["üíé","üëë","üçÄ","‚≠ê","üè∞","üî•"];

let grid=[];
let money=1000;
let jackpot=5000;

let spinning=false;
let bonusSpins=0;

const gridEl=document.getElementById("grid");
const moneyEl=document.getElementById("money");
const jackpotEl=document.getElementById("jackpot");
const winText=document.getElementById("winText");
const bonusInfo=document.getElementById("bonusInfo");
const wrapper=document.getElementById("wrapper");
const betInput=document.getElementById("betInput");

function rand(){ return symbols[Math.floor(Math.random()*symbols.length)]; }

/* ===== SCALE so it always fits screen ===== */
function fitScreen(){
    const scale = Math.min(
        window.innerWidth/600,
        window.innerHeight/720
    );
    wrapper.style.transform=`scale(${scale})`;
}
window.onresize=fitScreen;

/* ===== GRID ===== */
function createGrid(){
    gridEl.innerHTML="";
    for(let r=0;r<SIZE;r++){
        grid[r]=[];
        for(let c=0;c<SIZE;c++){
            const d=document.createElement("div");
            d.className="cell";
            d.dataset.r=r;
            d.dataset.c=c;
            gridEl.appendChild(d);
            grid[r][c]=rand();
        }
    }
    render();
}

function render(){
    document.querySelectorAll(".cell").forEach(cell=>{
        let r=cell.dataset.r,c=cell.dataset.c;
        cell.textContent=grid[r][c];
        cell.classList.remove("win","spinning");
    });
}

/* ===== PRO SPIN ANIMATION ===== */
function animateSpin(speed,done){
    const cells=document.querySelectorAll(".cell");
    cells.forEach(c=>c.classList.add("spinning"));

    setTimeout(()=>{
        cells.forEach(c=>c.classList.remove("spinning"));
        done();
    },speed);
}

/* ===== WINS ===== */
function checkWins(){
    let lines=[];

    for(let r=0;r<SIZE;r++)
        if(new Set(grid[r]).size===1)
            lines.push(grid[r].map((_,i)=>[r,i]));

    for(let c=0;c<SIZE;c++){
        let col=[grid[0][c],grid[1][c],grid[2][c],grid[3][c]];
        if(new Set(col).size===1)
            lines.push([[0,c],[1,c],[2,c],[3,c]]);
    }
    return lines;
}

/* ===== SPIN ===== */
function spin(){
    if(spinning) return;

    let bet=parseInt(betInput.value)||100;

    if(bonusSpins===0){
        if(money<bet) return;
        money-=bet;
        jackpot+=Math.floor(bet*0.1);
    }

    spinning=true;
    winText.textContent="";

    moneyEl.textContent=money;
    jackpotEl.textContent=jackpot;

    animateSpin(bonusSpins?2200:1400, ()=>{

        for(let r=0;r<SIZE;r++)
            for(let c=0;c<SIZE;c++)
                grid[r][c]=rand();

        render();

        let wins=checkWins();
        let total=0;

        wins.forEach(line=>{
            let mult=bonusSpins?Math.floor(Math.random()*8)+3:Math.floor(Math.random()*4)+2;
            total+=bet*mult;

            line.forEach(([r,c])=>{
                document.querySelector(`[data-r='${r}'][data-c='${c}']`).classList.add("win");
            });
        });

        if(Math.random()<0.01){
            total+=jackpot;
            jackpot=5000;
            winText.textContent="üí∞ JACKPOT!";
            winText.classList.add("mega");
        }
        else if(total>=bet*8){
            winText.textContent="üéâ MEGA WIN!";
            winText.classList.add("mega");
        }
        else if(total>=bet*4) winText.textContent="‚ú® BIG WIN!";
        else if(total>0) winText.textContent="WIN!";

        money+=total;
        moneyEl.textContent=money;
        jackpotEl.textContent=jackpot;

        spinning=false;

        if(bonusSpins>0){
            bonusSpins--;
            bonusInfo.textContent="BONUS SPINS: "+bonusSpins;
            if(bonusSpins>0) setTimeout(spin,900);
            else{
                wrapper.classList.remove("bonusMode");
                bonusInfo.textContent="";
            }
        }
    });
}

/* ===== BONUS ===== */
function buyBonus(){
    if(spinning || money<200) return;

    money-=200;
    bonusSpins=10;
    wrapper.classList.add("bonusMode");
    moneyEl.textContent=money;

    spin();
}

function goHome(){
    window.location.href="../index.html";
}

createGrid();
fitScreen();
</script>
</body>
</html>
